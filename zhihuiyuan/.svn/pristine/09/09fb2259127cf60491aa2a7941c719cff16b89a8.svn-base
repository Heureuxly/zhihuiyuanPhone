<?php
namespace Home\Controller;

use Think\Controller;

use Think\Upload;

class PersonageController extends HomeController {
	//个人中心
    public function index(){


    	if($_SESSION['user']){
    		$this->assign('user',$_SESSION['user']);
    	}
        $user = $_SESSION['user'];
        $password = $_SESSION['password'];
        $result = M('Users')->where(array(
                "user" => $user,
                'password' => $password,
                ))->find();

        $result2 = M('teacher')->where("id= ".$result['tid'])->find();



        $this->assign('result',$result);
        $this->assign('result2',$result2);

    	$this->display();
    }

    //完善个人资料
    public function orgData(){



        //显示个人资料
        if($_SESSION['user']){

            $userResulr1 = M('users')->where(array(
                "user" => $_SESSION['user'],
                'password' => $_SESSION['password'],
            ))->find();

            $userResulr = M('teacher')->where('id = '.$userResulr1['tid'])->find();

            $this->assign('userResulr',$userResulr);
            $this->assign('userResulr1',$userResulr1);
            $this->assign('user',$_SESSION['user']);
        }
        print_r($_POST);
        $this->display('Personage/perfectInfo');
        exit();

            if(!empty($_FILES['userfile']['name'])){
                //头像上传
                $upload = new Upload(); //实例化上传类
                $upload->maxSize = 1000000; //设置上传大小，字节
                $upload->exts =  array('jpg','gif','png','jpeg'); //限定后缀
                $upload->savePath = './'; //在根目录Uploads下
                $upload->autoSub = false;//不设置子目录
                $info = $upload->upload(); //执行上传方法
                if (!$info) {
                    $this->error($upload->getError()); //错误了
                    exit();
                } else {
                    //定义密码和时间
                    $_POST['face'] = $info['userfile']['savename'];
                    print_r($_POST);


                    //提交注册信息
                    $data = array(
                        'user' => I('post.user'),
                        'password' => I('post.password'),
                        'sex' => I('post.sex'),
                        'email' => I('post.email'),
                        'phone' => I('post.phone'),
                        'face' => I('post.face'),
                        'createtime' => I('post.createtime'),
                        );

                        $uid = M('Users')->add($data);

                    if ($uid) {
                        $this->success('注册成功!',U('Index/index'));
                    } else {
                        $this->error("提交数据失败!");
                    }
                }
                
            }else{
                

                //提交注册信息
                $data = array(
                    'user' => I('post.user'),
                    'password' => I('post.password'),
                    'sex' => I('post.sex'),
                    'email' => I('post.email'),
                    'phone' => I('post.phone'),
                    'createtime' => I('post.createtime'),
                    );

                    $uid=M('Users')->add($data);

                if ($uid) {
                    $this->success('注册成功!',U('Index/index'));
                } else {
                    $this->error("提交数据失败");
                }
            }   
      









    	
    	$this->display('Personage/perfectInfo');
    }
}